<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Reminder App</title>
    <style>
     /* Base Styling */
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        color: #333;
        margin: 0;
        padding: 20px;
    }
    
    h1 {
        color: #4CAF50;
        text-align: center;
    }
    
    .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        max-width: 1200px;
        margin: 0 auto;
        gap: 20px; /* Added gap between the form and the list */
    }
    
    .form-container, .reminder-list-container {
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border: 2px solid #ddd; /* Added border */
    }
    
    .form-container {
        flex: 1 1 45%;
    }
    
    .reminder-list-container {
        flex: 1 1 45%;
        margin-top: 20px;
    }
    
    .reminder-list {
        margin-top: 20px;
    }
    
    .reminder {
        background-color: #fff;
        border-radius: 5px;
        padding: 15px;
        margin: 10px 0;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    input, select, button {
        padding: 10px;
        font-size: 16px;
        margin: 5px 0;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
        
    /* Action Buttons */
    .actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    .btn {
        padding: 10px 20px;
        font-size: 14px;
        font-weight: bold;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
    }
    
    .btn:hover {
        transform: scale(1.05);
    }
    
    .start { background-color: #4CAF50; color: white; }
    .start:hover { background-color: #45a049; }
    
    .edit { background-color: #2196F3; color: white; }
    .edit:hover { background-color: #0b7dda; }
    
    .delete { background-color: #f44336; color: white; }
    .delete:hover { background-color: #d32f2f; }
    
    .loop { background-color: #ff9800; color: white; }
    .loop:hover { background-color: #fb8c00; }
    
    .end-loop { background-color: #9c27b0; color: white; }
    .end-loop:hover { background-color: #7b1fa2; }
    
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 20px;
        z-index: 1000;
    }
    
    .modal-content {
        background-color: #333;
        color: white;
        padding: 20px;
        border-radius: 5px;
        width: 80%;
        max-width: 500px;
        text-align: center;
    }
    
    .modal-content h2 {
        margin-top: 0;
    }

        .button-33 {
  background-color: #c2fbd7;
  border-radius: 100px;
  box-shadow: rgba(44, 187, 99, .2) 0 -25px 18px -14px inset,rgba(44, 187, 99, .15) 0 1px 2px,rgba(44, 187, 99, .15) 0 2px 4px,rgba(44, 187, 99, .15) 0 4px 8px,rgba(44, 187, 99, .15) 0 8px 16px,rgba(44, 187, 99, .15) 0 16px 32px;
  color: green;
  cursor: pointer;
  display: inline-block;
  font-family: CerebriSans-Regular,-apple-system,system-ui,Roboto,sans-serif;
  padding: 7px 20px;
  text-align: center;
  text-decoration: none;
  transition: all 250ms;
  border: 0;
  font-size: 16px;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.button-33:hover {
  box-shadow: rgba(44,187,99,.35) 0 -25px 18px -14px inset,rgba(44,187,99,.25) 0 1px 2px,rgba(44,187,99,.25) 0 2px 4px,rgba(44,187,99,.25) 0 4px 8px,rgba(44,187,99,.25) 0 8px 16px,rgba(44,187,99,.25) 0 16px 32px;
  transform: scale(1.05) rotate(-1deg);
}

/* CSS */
.button-54 {
  font-family: "Open Sans", sans-serif;
  font-size: 16px;
  letter-spacing: 2px;
  text-decoration: none;
  text-transform: uppercase;
  color: #000;
  cursor: pointer;
  border: 3px solid;
  padding: 0.25em 0.5em;
  box-shadow: 1px 1px 0px 0px, 2px 2px 0px 0px, 3px 3px 0px 0px, 4px 4px 0px 0px, 5px 5px 0px 0px;
  position: relative;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.button-54:active {
  box-shadow: 0px 0px 0px 0px;
  top: 5px;
  left: 5px;
}

@media (min-width: 768px) {
  .button-54 {
    padding: 0.25em 0.75em;
  }
}

        label {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 8px;
    display: block;
    color: #333;
}

input, select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    color: #333;
}

input[type="number"] {
    -moz-appearance: textfield;
    -webkit-appearance: none;
}

input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

select {
    cursor: pointer;
}

    </style>
</head>
<body>
    <!-- Modal structure -->
    <div id="custom-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <p id="modal-body"></p>
        </div>
    </div>

    <div class="container">
        <div class="form-container">
            <h1>Reminder App</h1>
            <button class="button-33" id="voiceCommandButton" onclick="startListening()">Voice Command</button>
            <ul>
                <li><strong>Start [Reminder Name]</strong> – create a one-time reminder.</li>
                <li><strong>Repeat [Reminder Name]</strong> – Start a repeating reminder.</li>
                <li><strong>Stop [Reminder Name]</strong> – Stop a repeating reminder.</li>
            </ul>
            <!-- Add New Reminder Form -->
            <div>
                <h3>Add New Reminder</h3>
                <label for="reminder-name">Reminder Name:</label>
                <input type="text" id="reminder-name" placeholder="Enter reminder name" />
                
                <label for="timer">Timer (in minutes):</label>
                <input type="number" id="timer" placeholder="Enter timer in minutes" min="1" />
                
                <label for="sound">Select Sound:</label>
                <select id="sound">
                    <option value="TimerApp/Audio/resttimeup.mp3">Beep</option>
                    <option value="TimerApp/Audio/worktimeup.mp3">Flute</option>
                    <option value="TimerApp/Audio/pop.wav">POP</option>
                </select>

                <button class="button-33" onclick="addReminder()">Add Reminder</button>
            </div>
        </div>

        <div class="reminder-list-container">
                        <button class="button-33" onclick="exportReminders()">Export Reminders</button>
                        <button class="button-33" onclick="document.getElementById('import-btn').click();">Import Reminders</button>

            <input type="file" class="button-33" onchange="importReminders(event)" style="display: none;" />
                        <h3>Reminders List</h3>

            <div class="reminder-list" id="reminder-list"></div>
        </div>
    </div>

    <script>
        let loopIntervals = {}; // To store loop interval IDs by reminder index
        let reminders = JSON.parse(localStorage.getItem("reminders")) || [];
        // Initialize the SpeechRecognition API
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;

if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = 'en-US';  // Set language
    recognition.interimResults = false;  // Don't show interim results (final result only)
    recognition.maxAlternatives = 1;     // Only show the best result

    // This is needed to track what happens when recognition starts
    recognition.onstart = function () {
        console.log("Voice recognition started.");
    };

    // Handle result after recognition finishes
    recognition.onresult = function (event) {
        let transcript = event.results[0][0].transcript.toLowerCase();
        transcript = transcript.replace(/\.$/, '');  // Remove the period at the end if present

        console.log("This was heard:", transcript);  // Should log the recognized command
        processVoiceCommand(transcript);
    };

    // Handle errors in speech recognition
    recognition.onerror = function (event) {
        console.error("Error occurred in recognition: ", event.error);
    };

    // Handle when recognition ends
    recognition.onend = function() {
        const button = document.getElementById('voiceCommandButton');

        button.classList.remove('button-49-active');
    };
} else {
    alert("Speech Recognition is not supported in your browser.");
}

// Start listening function
function startListening() {
    const button = document.getElementById('voiceCommandButton');
    
    // Change the button color to violet when listening starts
    button.classList.add('button-49-active');

    // Start the voice recognition
    recognition.start();

    // When listening ends, change the button color back to blue

}

         function showCustomModal(title, body) {
    const modal = document.getElementById('custom-modal');
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-body').textContent = body;
    modal.style.display = 'flex';

    // Use SpeechSynthesis API to read out the reminder name
    const utterance = new SpeechSynthesisUtterance(`Don't forget to ${title}`);

    // Get available voices
    const voices = speechSynthesis.getVoices();

    // Set the voice to Microsoft Ava (if available)
    const avaVoice = voices.find(voice => voice.name === 'Microsoft Ava Online (Natural) - English (United States)');
    if (avaVoice) {
        utterance.voice = avaVoice;
    }

    // Set the speech rate to 90% (default rate is 1.0)
    utterance.rate = 0.9;

    // Speak the reminder
    speechSynthesis.speak(utterance);
    
    // Close the modal when clicking outside
    modal.addEventListener('click', function (event) {
        if (event.target === modal) {
            closeModal();
        }
    });
}


    // Function to close the modal
    function closeModal() {
        const modal = document.getElementById('custom-modal');
        modal.style.display = 'none';
    }
        function requestNotificationPermission() {
    if ("Notification" in window) {
        Notification.requestPermission().then(permission => {
            if (permission !== "granted") {
                alert("Notifications are disabled. Enable them to use this feature.");
            }
        });
    } else {
        alert("Your browser does not support notifications.");
    }
}

        // Renders all reminders to the page
        function renderReminders() {
            const reminderList = document.getElementById("reminder-list");
            reminderList.innerHTML = "";  // Clear existing list

            reminders.forEach((reminder, index) => {
                const reminderDiv = document.createElement("div");
                reminderDiv.className = "reminder";
                reminderDiv.innerHTML = `
                    <h3>${reminder.name} - ${reminder.timer} minute(s)</h3>
                    <div class="actions">
                        <button  class="button-54" onclick="startTimer(${index})">Start</button>
                        <button  class="button-54" onclick="editReminder(${index})">Edit</button>
                        <button  class="button-54" onclick="deleteReminder(${index})">Delete</button>
                        <button  class="button-54" onclick="startLoop(${index})">Repeat</button>
                        <button  class="button-54" onclick="endLoop(${index})">End</button>
                    </div>
                `;
                reminderList.appendChild(reminderDiv);
            });
        }

        // Add a new reminder
        function addReminder() {
            const name = document.getElementById("reminder-name").value;
            const timer = document.getElementById("timer").value;
            const sound = document.getElementById("sound").value;

            if (name && timer) {
                reminders.push({ name, timer: parseInt(timer), sound });
                localStorage.setItem("reminders", JSON.stringify(reminders));
                renderReminders();

                // Clear inputs
                document.getElementById("reminder-name").value = "";
                document.getElementById("timer").value = "";
                document.getElementById("sound").value = "sound1.mp3";
            }
        }

        // Start a reminder timer
function startTimer(index) {
    const reminder = reminders[index];

    if (Notification.permission === "granted") {
        setTimeout(() => {
            showCustomModal(reminder.name, "Time's up!");

            const sound = new Audio(reminder.sound);
            sound.play();
        }, reminder.timer * 60000); // Convert minutes to milliseconds
    } else if (Notification.permission === "default") {
        requestNotificationPermission();
    } else {
        alert("Notifications are blocked. Enable them in your browser settings to use this feature.");
    }
}

        // Start a reminder timer in a loop
function startLoop(index) {
    const reminder = reminders[index];
    if (Notification.permission !== "granted") {
        alert("Please enable notifications to use this feature.");
        return;
    }

    const loopId = setInterval(() => {
            showCustomModal(reminder.name, "Time's up!");

            const sound = new Audio(reminder.sound);
            sound.play();
    }, reminder.timer * 60000); // Convert minutes to milliseconds

    loopIntervals[index] = loopId; // Store loop interval
    alert(`Loop started for: ${reminder.name}`);
}

// Stop a looping reminder
function endLoop(index) {
    if (loopIntervals[index]) {
        clearInterval(loopIntervals[index]);
        delete loopIntervals[index]; // Remove from tracking
        alert(`Loop ended for: ${reminder.name}`);
    } else {
        alert("No active loop for this reminder.");
    }
}

        // Edit a reminder
        function editReminder(index) {
            const reminder = reminders[index];
            const name = prompt("Enter new name:", reminder.name);
            const timer = prompt("Enter new timer in minutes:", reminder.timer);
            const sound = prompt("Enter new sound:", reminder.sound);

            if (name && timer && sound) {
                reminder.name = name;
                reminder.timer = parseInt(timer);
                reminder.sound = sound;
                localStorage.setItem("reminders", JSON.stringify(reminders));
                renderReminders();
            }
        }

        // Delete a reminder
        function deleteReminder(index) {
            reminders.splice(index, 1);
            localStorage.setItem("reminders", JSON.stringify(reminders));
            renderReminders();
        }

        // Export reminders as JSON
        function exportReminders() {
            const blob = new Blob([JSON.stringify(reminders)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "reminders.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Import reminders from a JSON file
        function importReminders(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const importedReminders = JSON.parse(e.target.result);
                    if (Array.isArray(importedReminders)) {
                        reminders = importedReminders;
                        localStorage.setItem("reminders", JSON.stringify(reminders));
                        renderReminders();
                    } else {
                        alert("Invalid reminder file.");
                    }
                } catch (error) {
                    alert("Failed to import reminders.");
                }
            };

            reader.readAsText(file);
        }

      function processVoiceCommand(command) {
    const startRegex = /start (.+)/;
    const loopRegex = /repeat (.+)/;
    const endLoopRegex = /stop (.+)/;

    // Voice Command: "Start [Reminder Name]"
    if (startRegex.test(command)) {
        const reminderName = command.match(startRegex)[1];
        const index = reminders.findIndex((r) => r.name.toLowerCase() === reminderName.toLowerCase());
        if (index !== -1) {
            startTimer(index);  // Start once
        } else {
            alert(`Reminder "${reminderName}" not found.`);
        }
    }
    // Voice Command: "Loop [Reminder Name]"
    else if (loopRegex.test(command)) {
        const reminderName = command.match(loopRegex)[1];
        const index = reminders.findIndex((r) => r.name.toLowerCase() === reminderName.toLowerCase());
        if (index !== -1) {
            startLoop(index);  // Start loop
        } else {
            alert(`Reminder "${reminderName}" not found.`);
        }
    }
    // Voice Command: "End Loop [Reminder Name]"
    else if (endLoopRegex.test(command)) {
        const reminderName = command.match(endLoopRegex)[1];
        const index = reminders.findIndex((r) => r.name.toLowerCase() === reminderName.toLowerCase());
        if (index !== -1) {
            endLoop(index);  // Stop loop
        } else {
            alert(`Reminder "${reminderName}" not found.`);
        }
    }
    // If command is not recognized
    else {
        alert("Command not recognized. Try one of the following phrases:\n\n" +
              "'Start [name]' to start a one-time reminder,\n" +
              "'Repeat [name]' to start a repeating reminder,\n" +
              "'Stop [name]' to stop the loop.");
    }
}


        // Initialize the app
        renderReminders();
        document.addEventListener("DOMContentLoaded", requestNotificationPermission);

    </script>
</body>
</html>
